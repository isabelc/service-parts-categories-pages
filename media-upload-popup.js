var TaxonomyImagesCreateAssociation;jQuery(document).ready(function(a){var t,e=0;if(t=window.dialogArguments||opener||parent||top,null!==t&&"taxonomyImagesPlugin"in t&&("tt_id"in t.taxonomyImagesPlugin&&(e=parseInt(t.taxonomyImagesPlugin.tt_id),isNaN(e)&&(e=0)),"term_name"in t.taxonomyImagesPlugin&&a(".create-association .term-name").html(TaxonomyImagesModal.termBefore+t.taxonomyImagesPlugin.term_name+TaxonomyImagesModal.termAfter)),e>0){a("body").addClass("taxonomy-images-modal");var n=a(".taxonomy-images-modal .create-association");a("#filter").prepend('<input type="hidden" name="taxonomy_images_plugin" value="'+e+'" />'),"image_id"in t.taxonomyImagesPlugin&&n.each(function(e,n){var o=a(n).parent().find(".taxonomy-image-button-image-id").val();o==t.taxonomyImagesPlugin.image_id&&(a(n).hide(),a(n).parent().find(".remove-association").css("display","inline"))})}a(".taxonomy-images-modal").on("click",".remove-association",function(){var n=a(this);return originalText=n.html(),n.html(TaxonomyImagesModal.removing),a.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"taxonomy_image_plugin_remove_association",wp_nonce:a(this).parent().find(".taxonomy-image-button-nonce-remove").val(),tt_id:e},cache:!1,success:function(o){"good"===o.status?n.html(TaxonomyImagesModal.removed).fadeOut(200,function(){a(this).hide();var n=parent.document.getElementById("taxonomy_image_plugin_"+e);a(n).replaceWith(a(t.taxonomyImagesPlugin.no_img).attr("id","taxonomy_image_plugin_"+e));var o=parent.document.getElementById("remove-"+e);a(o).addClass("hide"),a(parent.document.getElementById("taxonomy-image-control-"+e)).find(".image_id").val("0"),a(this).parent().find(".create-association").show(),a(this).html(originalText)}):"bad"===o.status&&alert(o.why)}}),!1}),a(".taxonomy-images-modal").on("click",".create-association",function(){var t,n;if(0!=e)return t=a(this),n=t.html(),t.html(TaxonomyImagesModal.associating),a.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"taxonomy_image_create_association",wp_nonce:a(this).parent().find(".taxonomy-image-button-nonce-create").val(),attachment_id:a(this).parent().find(".taxonomy-image-button-image-id").val(),tt_id:parseInt(e)},success:function(o){if("good"===o.status){var i=t.parent().attr("id");a(".taxonomy-image-modal-control").each(function(t,e){return i==a(e).attr("id")?!0:(a(e).find(".create-association").show(),void a(e).find(".remove-association").hide())});var m=a(parent.document.getElementById("taxonomy-image-control-"+e));m.find(".taxonomy-images-set-featured").each(function(t,e){a(e).replaceWith(a("<img />").attr({src:o.attachment_thumb_src,id:a(e).attr("id")}))}),m.find(".image_id").val(o.image_id),m.find(".remove").each(function(t,e){a(e).removeClass("hide")}),t.show().html(TaxonomyImagesModal.success).fadeOut(200,function(){var e=t.parent().find(".remove-association");void 0!==e[0]&&(a(e).css("display","inline"),t.hide(),t.html(n))})}else"bad"===o.status&&alert(o.why)}}),!1})});
